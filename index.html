<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Countystat acs-r by robertpickering</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Countystat acs-r</h1>
        <p class="header"></p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/robertpickering/CountyStat_ACS-R/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/robertpickering/CountyStat_ACS-R/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/robertpickering/CountyStat_ACS-R">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/robertpickering">robertpickering</a></p>


      </header>
      <section>
        <h1>
<a id="countystat_acs-r" class="anchor" href="#countystat_acs-r" aria-hidden="true"><span class="octicon octicon-link"></span></a>CountyStat_ACS-R</h1>

<p>The following is a basic synopsis of the various files and how they work together to get Census data and combine it into a CSV formated file suitable for upload to the Socrata Open Performance Platform.</p>

<hr>

<h2>
<a id="installacs-rr" class="anchor" href="#installacs-rr" aria-hidden="true"><span class="octicon octicon-link"></span></a>installACS-R.R</h2>

<p>This file must be run before any of the others are.  But, it only needs to be run once as it basically just sets up the environment withing R.</p>

<p>The first thing that the install script does is install the ACS-R package from the CRAN repository.  After that, a few helper packages are installed for use later.</p>

<p>Finally, the API key is installed.  Edit line 13 by replacing ... with your key.  Make sure the quotation marks stay in place.  If you don't have an API key on hand, you can get one from the US Census website.  </p>

<p>Documentation for the ACS-R package is available from CRAN <a href="https://cran.r-project.org/web/packages/acs/acs.pdf">here</a>.  Additionally, there is a great article written by the author of the package, Ezra Haber Glenn, <a href="http://eglenn.scripts.mit.edu/citystate/wp-content/uploads/2013/06/wpid-working_with_acs_R3.pdf">here</a>.</p>

<h2>
<a id="geographiesr" class="anchor" href="#geographiesr" aria-hidden="true"><span class="octicon octicon-link"></span></a>geographies.R</h2>

<p>This file creates a series of geographic set objects that will be used later when the queries to the API are made.  The geo.make method is used to create a geographic object which, can be combined with other geographic objects to make a single composite geographic object.  The geo.lookup method may be used in the console to find other geographic locations and names to add to the list of geographies to be made.  As shown in the current script, counties may be concatenated.  Other location types may be concatenated as well such as census tracts.  </p>

<p>Currently, there are 38 counties that are listed.  These are combined into the <strong>allstates</strong> variable.</p>

<h2>
<a id="measuresr" class="anchor" href="#measuresr" aria-hidden="true"><span class="octicon octicon-link"></span></a>measures.R</h2>

<p>This file contains a vector (R terminology for an array) for the ACS tables that are to be queried later.  Additionally, it contains a vector for the years to be queried.  The current version of the ACS-R package primarily supports the five year American Community Survey from years 2010 to 2013.  There is some limited support for the one and three year surveys but they are not really suitable (stable enough) for the type of bulk data acquisition that these scripts perform.  Other tables can be found using the acs.lookup method.  </p>

<h2>
<a id="getdatar" class="anchor" href="#getdatar" aria-hidden="true"><span class="octicon octicon-link"></span></a>getdata.R</h2>

<p>This file can be run by itself as it will source the geographies.R file to build the appropriate geographic sets.  This is the file that accesses the Census Data via its API and as such may take quite a while to execute - especially if the geography set is large. Some tables, such as B17001 have 59 variables associated with it.  If all of those variables are not required, it is possible to edit what data is fetched to reduce the amount of data retrieved and the amount of time required to perform the query.  For instance this line will retrieve all 59 variables for each geographic location for one year.</p>

<pre><code>acs.fetch(endyear = years[1], geography = allstates, table.number = "B17001", col.names = "pretty")
</code></pre>

<p>Modifying it slightly by adding the keyword variable reduces the number of variables to 1.   <code>acs.fetch(endyear = years[1], geography = allstates, table.number = "B17001", col.names = "pretty", keyword = c("75","Male", "below"))</code></p>

<p>Using the acs.lookup method on the console is a good way to experiment with creating the best queries.  </p>

<hr>

<p>Initially, there was a desire to have the data retrieved in a while loop.  Unfortunately, when an error occurs in the retrieval of data, the loop will terminate and not fetch the rest of the data. In the case of the years 2010 and 2012, data tables B08136 and B23025 don't exist and so they error out.  This caused the other years to not fetch data beyond these errors as well.  Consequently, each table/year combination is fetched individually.  The drawback to this is that the file may grow exceedingly large in the future.  However, it lends itself well to debugging.  The tables are then combined by year into four separate lists and then the intermediate data is dispensed with.</p>

<h2>
<a id="format_datar" class="anchor" href="#format_datar" aria-hidden="true"><span class="octicon octicon-link"></span></a>format_data.R</h2>

<p>This file can be run with no modifications once the install.R script has been run successfully.  It sources the getdata.R file which, will pull all the data as described in the previous section.  Once that has successfully acquired the data, a series of files for the individual measures are sourced which, transform the ACS-R data objects into data frames.  If measures other than the ones listed in getdata.R are required, an additional formated_xxx.R file must be created with an appropriate source line added to format_data.R with the corresponding measure added to the list called alldata.  Once the alldata list is populated, a while loop writes the data to the the file alldata.csv.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
